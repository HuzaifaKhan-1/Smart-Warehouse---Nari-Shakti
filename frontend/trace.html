<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Traceability | AgriFresh AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        :root {
            --timeline-line: rgba(46, 125, 50, 0.1);
            --completed: #2E7D32;
            --active: #F9A825;
            --pending: #90A4AE;
            --ai-purple: #7E57C2;
        }

        /* Timeline Enhancements */
        .timeline-container {
            position: relative;
            padding: 20px 0;
        }

        .timeline-container::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 20px;
            bottom: 20px;
            width: 3px;
            background: var(--timeline-line);
            border-radius: 10px;
        }

        .timeline-stage {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline-stage:last-child {
            margin-bottom: 0;
        }

        .stage-dot {
            position: absolute;
            left: 11px;
            top: 5px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--pending);
            z-index: 2;
            transition: var(--transition-smooth);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 1);
        }

        .stage-dot.completed {
            border-color: var(--completed);
            background: var(--completed);
            box-shadow: 0 0 15px rgba(46, 125, 50, 0.2);
        }

        .stage-dot.active {
            border-color: var(--active);
            animation: pulseActive 2s infinite;
        }

        @keyframes pulseActive {
            0% {
                box-shadow: 0 0 0 0 rgba(249, 168, 37, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(249, 168, 37, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(249, 168, 37, 0);
            }
        }

        .stage-card {
            padding: 24px;
            background: white;
            border: 1px solid var(--card-border);
            border-radius: 20px;
            transition: var(--transition-smooth);
            position: relative;
            box-shadow: var(--shadow-soft);
        }

        .timeline-stage:hover .stage-card {
            transform: translateX(10px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-light);
        }

        .ai-highlight {
            border: 2px solid var(--ai-purple) !important;
            background: linear-gradient(135deg, #ffffff 0%, #f3e5f5 100%) !important;
        }

        .ai-highlight::after {
            content: 'AI OPTIMIZED';
            position: absolute;
            top: -12px;
            right: 20px;
            background: var(--ai-purple);
            color: white;
            font-size: 0.65rem;
            padding: 4px 12px;
            border-radius: 100px;
            font-weight: 800;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 10px rgba(126, 87, 194, 0.3);
        }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stage-title {
            font-size: 1.15rem;
            font-weight: 800;
            margin-bottom: 2px;
            color: var(--text-primary);
        }

        .stage-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .info-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px;
            background: var(--bg-light);
            border-radius: 14px;
            margin-bottom: 10px;
            transition: var(--transition-smooth);
        }

        .info-row:hover {
            background: white;
            box-shadow: var(--shadow-soft);
        }

        .info-icon {
            width: 42px;
            height: 42px;
            background: white;
            color: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: var(--shadow-soft);
        }

        .info-content .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .info-content .value {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .stage-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--card-border);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .meta-item i {
            color: var(--primary);
            width: 16px;
        }

        .badge-status {
            font-size: 0.65rem;
            padding: 6px 12px;
            border-radius: 100px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-completed {
            background: var(--success-bg);
            color: var(--primary);
        }

        .status-active {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .status-pending {
            background: #F5F5F5;
            color: var(--text-secondary);
        }

        /* Scanner Trigger */
        .scanner-trigger {
            border: 2px dashed var(--card-border);
            transition: var(--transition-smooth);
            background: white;
        }

        .scanner-trigger:hover {
            border-color: var(--primary);
            background: var(--success-bg);
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* History List */
        .history-list {
            margin-top: 15px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--bg-light);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .risk-badge {
            font-size: 0.65rem;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 800;
            text-transform: uppercase;
        }

        .risk-low {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .risk-med {
            background: #FFF3E0;
            color: #EF6C00;
        }

        /* Animated Progress bar for history mapping */
        .history-path {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .path-step {
            padding: 6px 12px;
            background: var(--bg-light);
            border-radius: 8px;
            border: 1px solid var(--card-border);
        }

        .path-arrow {
            color: var(--primary);
        }

        /* Responsive spacing */
        .main-wrapper {
            padding: 40px 40px !important;
        }

        /* Dropdown Styling */
        .batch-selector {
            appearance: none;
            background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%232E7D32' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E") no-repeat right 20px center;
            background-size: 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="blob"></div>
    <div class="blob-2"></div>

    <aside class="sidebar">
        <div class="brand" style="display: flex; align-items: center; gap: 12px; margin-bottom: 50px; padding: 0 10px;">
            <div
                style="width: 45px; height: 45px; background: var(--primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white;">
                <i class="fas fa-leaf fa-lg"></i>
            </div>
            <div>
                <h2 style="font-weight: 800; font-size: 1.4rem; color: var(--primary); letter-spacing: -0.5px;">
                    AgriFresh</h2>
                <p
                    style="font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); font-weight: 700;">
                    AI Traceability</p>
            </div>
        </div>

        <nav>
            <a href="dashboard.html" class="nav-item"><i class="fas fa-table-cells-large"></i> Dashboard</a>
            <a href="inventory.html" class="nav-item"><i class="fas fa-boxes-stacked"></i> Inventory</a>
            <a href="analytics.html" class="nav-item"><i class="fas fa-chart-pie"></i> Analytics</a>
            <a href="trace.html" class="nav-item active"><i class="fas fa-route"></i> Traceability</a>
        </nav>
    </aside>

    <main class="main-wrapper">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
            <div>
                <h1 style="font-size: 2.4rem; font-weight: 800; color: var(--text-primary); letter-spacing: -1px;">
                    Provenance Explorer</h1>
                <p style="color: var(--text-secondary); font-weight: 500;">End-to-end supply chain transparency verified
                    by Blockchain</p>
            </div>
            <button class="btn-premium" style="padding: 14px 28px; box-shadow: 0 4px 15px rgba(46, 125, 50, 0.2);">
                <i class="fas fa-file-shield"></i> Generate Audit Report
            </button>
        </header>

        <!-- Feature 1: QR Scanner + Dynamic Batch Selector -->
        <div style="display: grid; grid-template-columns: 1fr 320px; gap: 20px; margin-bottom: 40px;">
            <div style="position: relative; display: flex; align-items: center;">
                <select id="batchSelect" class="filter-select batch-selector"
                    style="width: 100%; padding: 20px 24px; padding-right: 170px; font-size: 1.1rem; box-shadow: var(--shadow-soft); border-radius: 16px;">
                    <!-- Options injected by JS -->
                </select>
                <button id="traceBtn" class="btn-premium"
                    style="position: absolute; right: 8px; padding: 12px 28px; border-radius: 12px;">Trace
                    Origin</button>
            </div>
            <div class="glass-panel scanner-trigger" onclick="simulateScan()"
                style="display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; border-radius: 16px; font-weight: 700;">
                <i class="fas fa-qrcode fa-xl"></i>
                <div>
                    <div style="font-size: 0.95rem;">Scan QR Code</div>
                    <div style="font-size: 0.65rem; font-weight: 500; opacity: 0.7;">Upload image or live scan</div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 380px 1fr; gap: 35px; align-items: start;">

            <!-- Left Sidebars -->
            <div style="display: flex; flex-direction: column; gap: 24px;">

                <!-- Batch Summary Card -->
                <div class="glass-panel" style="padding: 30px; text-align: center;">
                    <div id="qrContainer"
                        style="background: white; padding: 15px; border-radius: 24px; display: inline-block; margin-bottom: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.06); border: 1px solid var(--card-border);">
                        <!-- QR Injected by JS -->
                    </div>
                    <h2 id="displayBatchId"
                        style="font-weight: 800; font-size: 2rem; color: var(--text-primary); margin-bottom: 5px;">
                        #AF-290</h2>
                    <span id="displayCropBadge" class="badge"
                        style="background: var(--success-bg); color: var(--primary); padding: 5px 16px; font-size: 0.8rem; font-weight: 800;">Tomato
                        • Grade A+</span>

                    <div
                        style="margin-top: 30px; text-align: left; background: var(--bg-light); padding: 20px; border-radius: 16px; border: 1px solid var(--card-border);">
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 0.9rem;">
                            <span style="color: var(--text-secondary); font-weight: 600;">Status</span>
                            <span id="displayStatus" style="color: var(--active); font-weight: 800;">● In Storage</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                            <span style="color: var(--text-secondary); font-weight: 600;">Current Hub</span>
                            <span id="displayHub" style="font-weight: 750; color: var(--text-primary);">Nashik
                                Central</span>
                        </div>
                    </div>
                </div>

                <!-- Feature 3: Farmer Information Panel -->
                <div class="glass-panel" style="padding: 24px;">
                    <h3
                        style="margin-bottom: 20px; font-size: 1.1rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-id-card-clip"></i> Farmer Professional Profile
                    </h3>
                    <div id="farmerInfo">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Feature 4: Storage History Section -->
                <div class="glass-panel" style="padding: 24px;">
                    <h3
                        style="margin-bottom: 20px; font-size: 1.1rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-clock-rotate-left"></i> Storage Asset History
                    </h3>

                    <div id="historyPath" class="history-path">
                        <!-- Injected by JS -->
                    </div>

                    <div id="historyList" class="history-list">
                        <!-- Injected by JS -->
                    </div>

                    <!-- Performance mini chart placeholder -->
                    <div
                        style="margin-top: 20px; height: 40px; background: rgba(46, 125, 50, 0.03); border-radius: 10px; display: flex; align-items: flex-end; padding: 5px; gap: 4px;">
                        <div style="flex:1; height: 40%; background: var(--primary); border-radius: 4px; opacity: 0.4;">
                        </div>
                        <div style="flex:1; height: 60%; background: var(--primary); border-radius: 4px; opacity: 0.6;">
                        </div>
                        <div style="flex:1; height: 55%; background: var(--primary); border-radius: 4px; opacity: 0.5;">
                        </div>
                        <div style="flex:1; height: 80%; background: var(--primary); border-radius: 4px; opacity: 0.8;">
                        </div>
                        <div style="flex:1; height: 90%; background: var(--primary); border-radius: 4px;"></div>
                        <div style="flex:1; height: 85%; background: var(--primary); border-radius: 4px; opacity: 0.9;">
                        </div>
                    </div>
                    <p
                        style="font-size: 0.6rem; color: var(--text-secondary); text-align: center; margin-top: 8px; font-weight: 700;">
                        LIVE ENVIRONMENTAL STABILITY TELEMETRY</p>
                </div>
            </div>

            <!-- Feature 2: VERTICAL LIFECYCLE TIMELINE -->
            <div class="glass-panel" style="padding: 40px; border-radius: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                    <h3 style="font-weight: 900; font-size: 1.5rem; color: var(--primary);">Lifecycle Provenance</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary);">Tracking ID:
                            <span id="trackingId" style="color: var(--text-primary);">BT-NSK-4922110</span></span>
                    </div>
                </div>

                <div id="timelineContainer" class="timeline-container">
                    <!-- Dynamic Stages Injected Here -->
                </div>
            </div>

        </div>
    </main>

    <script>
        /**
         * FEATURE 1: MULTI-BATCH DATA STRUCTURE
         */
        const batchData = {
            "AF-290": {
                batch_id: "AF-290",
                crop_name: "Tomato",
                grade: "A+",
                status: "In Storage",
                location: "Nashik Central Hub",
                tracking_id: "BT-NSK-4922110",
                farmer: {
                    name: "Rahul Sharma",
                    id: "FRM-NSK-92811-A",
                    location: "Sangli North, MH",
                    contact: "+91 98XX4 X2109"
                },
                history: {
                    path: ["Zone C-4", "Zone B-2", "Current"],
                    logs: [
                        { title: "Temperature Stability", desc: "14.5°C → 12.8°C avg.", icon: "fa-temperature-arrow-down", color: "var(--info)" },
                        { title: "Humidity Control", desc: "Dropped from 70% to 65%", icon: "fa-droplet-degree", color: "var(--primary)" },
                        { title: "Spoilage Risk Index", desc: "System verification level", risk: "Low" }
                    ]
                },
                timeline: [
                    { stage: "Harvested", time: "Feb 18, 2026 • 09:42 AM", status: "completed", meta: [["fa-location-dot", "Sangli, MH - Plot 4B"], ["fa-temperature-low", "24.2°C (Ambient)"], ["fa-vial", "Quality Score: 98/100"], ["fa-person-digging", "Lead: S. Kulkarni"]] },
                    { stage: "Transported", time: "Feb 19, 2026 • 02:15 PM", status: "completed", meta: [["fa-truck-container", "Vehicle: MH-15-AB-2091"], ["fa-thermometer-half", "Avg Transit: 14.5°C"], ["fa-route", "Distance: 142.5 KM"], ["fa-clock", "Duration: 4h 22m"]] },
                    { stage: "Warehouse Arrival", time: "Feb 20, 2026 • 08:30 AM", status: "completed", meta: [["fa-warehouse", "Nashik Central Hub"], ["fa-weight-scale", "Weight: 450.0 Kg"], ["fa-barcode", "LUIS Token Signed"], ["fa-clipboard-check", "Ingestion: Cleared"]] },
                    { stage: "Assigned Zone", time: "Feb 20, 2026 • 11:00 AM", status: "active", meta: [["fa-box-open", "Storage Bin: B-209"], ["fa-map-pin", "Cold Section C-4"], ["fa-temperature-arrow-down", "Live Temp: 12.8°C"], ["fa-droplet", "Humidity: 68%"]] },
                    { stage: "AI Prediction", time: "Processed Mar 02, 2026", status: "pending", isAi: true, meta: [["fa-brain", "Model: SpoilageV2_RL"], ["fa-calendar-check", "Shelf Life: 12 Days (Est)"], ["fa-chart-line-up", "Quality Retention: 94%"], ["fa-bullseye", "Best Exit: Local Retail"]] },
                    { stage: "Dispatch", time: "Awaiting AI Signal", status: "pending", meta: [["fa-truck-ramp-box", "Logistics Allocated"], ["fa-file-invoice", "Transit Permit Ready"]] },
                    { stage: "Market Delivery", time: "Final Milestone", status: "pending", meta: [["fa-shop", "Destination: APMC Vashi"], ["fa-handshake-angle", "Merchant Assigned"]] }
                ]
            },
            "AF-431": {
                batch_id: "AF-431",
                crop_name: "Onion",
                grade: "Export Quality",
                status: "In Transit",
                location: "Vashi Highway MH",
                tracking_id: "BT-ONN-112204",
                farmer: {
                    name: "Vikram Patil",
                    id: "FRM-PUN-3341-B",
                    location: "Junner, Pune, MH",
                    contact: "+91 88XX1 X0092"
                },
                history: {
                    path: ["Zone D-1", "Loading Bay", "Transit"],
                    logs: [
                        { title: "Moisture Check", desc: "Optimal 12% maintained", icon: "fa-water", color: "var(--info)" },
                        { title: "Air Flow Log", desc: "750 CFM constant ventilation", icon: "fa-wind", color: "var(--primary)" },
                        { title: "Curing Phase", desc: "Dryness verification passed", risk: "Low" }
                    ]
                },
                timeline: [
                    { stage: "Harvested", time: "Feb 10, 2026 • 07:00 AM", status: "completed", meta: [["fa-location-dot", "Junner, Plot A1"], ["fa-sun", "Cured for 5 Days"], ["fa-vial", "Quality: 95/100"]] },
                    { stage: "Transported", time: "Feb 15, 2026 • 10:00 AM", status: "completed", meta: [["fa-truck", "Vehicle: MH-12-PQ-4412"], ["fa-route", "Distance: 80 KM"]] },
                    { stage: "Warehouse Arrival", time: "Feb 15, 2026 • 04:00 PM", status: "completed", meta: [["fa-warehouse", "Pune Hub 2"], ["fa-weight-scale", "600.0 Kg"]] },
                    { stage: "Assigned Zone", time: "Feb 16, 2026 • 09:00 AM", status: "completed", meta: [["fa-box", "Bin O-99"], ["fa-fan", "Ventilation Area D-1"]] },
                    { stage: "AI Prediction", time: "Processed Feb 17, 2026", status: "completed", isAi: true, meta: [["fa-brain", "Model: OnionLife v1"], ["fa-shipping-fast", "Dispatch Suggested: NOW"]] },
                    { stage: "Dispatch", time: "Feb 20, 2026 • 11:00 AM", status: "active", meta: [["fa-truck-ramp-box", "Loading for Vashi APMC"], ["fa-file-invoice", "Interstate Permit Active"]] },
                    { stage: "Market Delivery", time: "Projected Feb 21, 2026", status: "pending", meta: [["fa-shop", "Vashi Main Market"]] }
                ]
            },
            "AF-992": {
                batch_id: "AF-992",
                crop_name: "Mango",
                grade: "Premium Alphonso",
                status: "AI Analysis",
                location: "Ratnagiri Unit 4",
                tracking_id: "BT-MNG-99221",
                farmer: {
                    name: "Sanjay Desai",
                    id: "FRM-RAT-0021-M",
                    location: "Ratnagiri, MH",
                    contact: "+91 77XX1 X4451"
                },
                history: {
                    path: ["Pre-Cooling", "Sorting B", "AI Camera"],
                    logs: [
                        { title: "Ripening Index", desc: "Scale 4 - Pre-mature Export", icon: "fa-temperature-high", color: "var(--active)" },
                        { title: "Ethylene Level", desc: "Monitored 0.5 ppm", icon: "fa-vial", color: "var(--primary)" },
                        { title: "Spoilage Risk", desc: "Verification Pending", risk: "Medium" }
                    ]
                },
                timeline: [
                    { stage: "Harvested", time: "Feb 25, 2026 • 06:00 AM", status: "completed", meta: [["fa-location-dot", "Ratnagiri Orchard 2"]] },
                    { stage: "Transported", time: "Feb 25, 2026 • 11:00 AM", status: "completed", meta: [["fa-truck", "Refrigerated Van"]] },
                    { stage: "Warehouse Arrival", time: "Feb 25, 2026 • 02:00 PM", status: "completed", meta: [["fa-warehouse", "Ratnagiri Hub"]] },
                    { stage: "Assigned Zone", time: "Feb 25, 2026 • 04:00 PM", status: "completed", meta: [["fa-snowflake", "Pre-cooling Zone P-1"]] },
                    { stage: "AI Prediction", time: "Analyzing...", status: "active", isAi: true, meta: [["fa-brain", "Model: FruitExpert RL"], ["fa-camera", "Image Processing..."]] },
                    { stage: "Dispatch", time: "Pending Analysis", status: "pending", meta: [["fa-truck-fast", "Air Freight Assigned"]] },
                    { stage: "Market Delivery", time: "Dubai International Market", status: "pending", meta: [["fa-plane", "Awaiting Clearance"]] }
                ]
            },
            "AF-120": {
                batch_id: "AF-120",
                crop_name: "Potato",
                grade: "B+",
                status: "Harvested",
                location: "Indore Farms",
                tracking_id: "BT-POT-12011",
                farmer: {
                    name: "Amit Gehlot",
                    id: "FRM-IND-7712",
                    location: "Indore, MP",
                    contact: "+91 91XX0 X3321"
                },
                history: {
                    path: ["Harvest Bay"],
                    logs: [
                        { title: "Soil Sample", desc: "Cleaned and verified", icon: "fa-seedling", color: "var(--primary)" },
                        { title: "Batching", desc: "50kg sacks organized", icon: "fa-cubes", color: "var(--info)" },
                        { title: "Risk Level", desc: "Initial Assessment", risk: "Low" }
                    ]
                },
                timeline: [
                    { stage: "Harvested", time: "Feb 27, 2026 • 08:00 AM", status: "active", meta: [["fa-location-dot", "Indore Sector 5"], ["fa-tractor", "Organic Harvest"]] },
                    { stage: "Transported", time: "Pending", status: "pending", meta: [["fa-clock", "Scheduling Transit"]] },
                    { stage: "Warehouse Arrival", time: "Pending", status: "pending", meta: [["fa-warehouse", "Nashik Main (Projected)"]] },
                    { stage: "Assigned Zone", time: "Waiting", status: "pending", meta: [] },
                    { stage: "AI Prediction", time: "Queued", status: "pending", isAi: true, meta: [] },
                    { stage: "Dispatch", time: "Future", status: "pending", meta: [] },
                    { stage: "Market Delivery", time: "Projected 10 Days", status: "pending", meta: [] }
                ]
            }
        };

        /**
         * FEATURE 3: DYNAMIC UI UPDATE (CORE LOGIC)
         */
        function loadBatch(batchId) {
            const data = batchData[batchId];
            if (!data) return;

            // Update Header & Summary
            document.getElementById('displayBatchId').innerText = `#${data.batch_id}`;
            document.getElementById('displayCropBadge').innerText = `${data.crop_name} • Grade ${data.grade}`;
            document.getElementById('displayStatus').innerHTML = `● ${data.status}`;
            document.getElementById('displayHub').innerText = data.location;
            document.getElementById('trackingId').innerText = data.tracking_id;

            // FEATURE 5: QR CODE INTEGRATION
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${data.batch_id}&color=2E7D32`;
            document.getElementById('qrContainer').innerHTML = `<img src="${qrUrl}" alt="QR Code" style="width: 140px; display: block; border-radius: 10px;">`;

            // Update Farmer Info
            const farmerHtml = `
                <div class="info-row">
                    <div class="info-icon"><i class="fas fa-user-circle"></i></div>
                    <div class="info-content">
                        <div class="label">Primary Farmer</div>
                        <div class="value">${data.farmer.name}</div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-icon"><i class="fas fa-fingerprint"></i></div>
                    <div class="info-content">
                        <div class="label">Farmer ID</div>
                        <div class="value">${data.farmer.id}</div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-icon"><i class="fas fa-map-location-dot"></i></div>
                    <div class="info-content">
                        <div class="label">Farm Location</div>
                        <div class="value">${data.farmer.location}</div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-icon"><i class="fas fa-phone-volume"></i></div>
                    <div class="info-content">
                        <div class="label">Contact Endpoint</div>
                        <div class="value">${data.farmer.contact}</div>
                    </div>
                </div>
            `;
            document.getElementById('farmerInfo').innerHTML = farmerHtml;

            // Update Storage History
            let pathHtml = '';
            data.history.path.forEach((step, index) => {
                pathHtml += `<span class="path-step">${step}</span>`;
                if (index < data.history.path.length - 1) {
                    pathHtml += `<i class="fas fa-arrow-right path-arrow"></i>`;
                }
            });
            document.getElementById('historyPath').innerHTML = pathHtml;

            let logHtml = '';
            data.history.logs.forEach(log => {
                logHtml += `
                    <div class="history-item">
                        <div>
                            <div style="font-weight: 800; font-size: 0.9rem; color: var(--text-primary);">${log.title}</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 600;">${log.desc}</div>
                        </div>
                        ${log.risk ? `<span class="risk-badge risk-${log.risk.toLowerCase()}">${log.risk} Risk</span>` : `<i class="fas ${log.icon}" style="color: ${log.color};"></i>`}
                    </div>
                `;
            });
            document.getElementById('historyList').innerHTML = logHtml;

            /**
             * FEATURE 4: DYNAMIC TIMELINE GENERATION
             */
            const timelineContainer = document.getElementById('timelineContainer');
            timelineContainer.innerHTML = '';

            data.timeline.forEach((item, index) => {
                const stageEl = document.createElement('div');
                stageEl.className = 'timeline-stage';
                stageEl.style.animationDelay = `${(index + 1) * 0.1}s`;

                let metaHtml = '';
                item.meta.forEach(m => {
                    metaHtml += `<div class="meta-item"><i class="fas ${m[0]}"></i> ${m[1]}</div>`;
                });

                const statusLabel = item.status === 'completed' ? 'Verified' : (item.status === 'active' ? 'Active' : 'Queued');
                const cardStyle = item.status === 'active' ? 'style="border-left: 5px solid var(--active); background: #FFFBEE;"' : '';
                const aiClass = item.isAi ? 'ai-highlight' : '';

                stageEl.innerHTML = `
                    <div class="stage-dot ${item.status}"></div>
                    <div class="stage-card ${aiClass}" ${cardStyle}>
                        <div class="stage-header">
                            <div>
                                <h4 class="stage-title">${index + 1}. ${item.stage}</h4>
                                <span class="stage-time">${item.time}</span>
                            </div>
                            <span class="badge-status status-${item.status}">${statusLabel}</span>
                        </div>
                        <div class="stage-meta">
                            ${metaHtml}
                        </div>
                    </div>
                `;
                timelineContainer.appendChild(stageEl);
            });

            // Re-apply hover listeners to new elements
            attachHoverListeners();
        }

        /**
         * INITIALIZATION & EVENT LISTENERS
         */
        function initBatchSelector() {
            const select = document.getElementById('batchSelect');
            select.innerHTML = '';

            Object.keys(batchData).forEach(id => {
                const option = document.createElement('option');
                option.value = id;
                option.text = `${id} — ${batchData[id].crop_name}`;
                select.appendChild(option);
            });

            select.addEventListener('change', (e) => loadBatch(e.target.value));

            // Initial load
            loadBatch("AF-290");
        }

        function attachHoverListeners() {
            document.querySelectorAll('.timeline-stage').forEach(stage => {
                stage.addEventListener('mouseenter', () => {
                    const dot = stage.querySelector('.stage-dot');
                    if (!dot.classList.contains('completed')) {
                        dot.style.transform = 'scale(1.4)';
                        dot.style.borderColor = 'var(--primary)';
                    }
                });
                stage.addEventListener('mouseleave', () => {
                    const dot = stage.querySelector('.stage-dot');
                    dot.style.transform = 'scale(1)';
                });
            });
        }

        function simulateScan() {
            const keys = Object.keys(batchData);
            const randomBatch = keys[Math.floor(Math.random() * keys.length)];
            const btn = document.querySelector('.scanner-trigger');

            btn.style.borderColor = 'var(--primary)';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin fa-xl"></i> <div>Scanning...</div>';

            setTimeout(() => {
                document.getElementById('batchSelect').value = randomBatch;
                loadBatch(randomBatch);
                btn.innerHTML = '<i class="fas fa-qrcode fa-xl"></i> <div><div style="font-size: 0.95rem;">Scan QR Code</div><div style="font-size: 0.65rem; font-weight: 500; opacity: 0.7;">Upload image or live scan</div></div>';
            }, 1000);
        }

        const traceBtn = document.getElementById('traceBtn');
        traceBtn.addEventListener('click', () => {
            traceBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tracing...';
            setTimeout(() => {
                traceBtn.innerHTML = 'Trace Origin';
            }, 800);
        });

        // Start
        window.onload = initBatchSelector;
    </script>
</body>

</html>